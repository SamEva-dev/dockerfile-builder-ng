import{b as ae}from"./chunk-MJQ3KY2W.js";import{a as J,b as Q,c as Z}from"./chunk-ZXMRF2QA.js";import"./chunk-NNZJJLOA.js";import{a as $,b as ee,c as le,d as me,e as ce}from"./chunk-UHGY6NSJ.js";import{a as Y,b as re}from"./chunk-YUABFYP2.js";import{c as G,d as H,e as X,g as q,i as te,j as ne,k as oe,l as ie}from"./chunk-X2UVP5SW.js";import"./chunk-G2M2UXHZ.js";import"./chunk-HEVQ3NIT.js";import"./chunk-Z7WK5Y2H.js";import{b as N}from"./chunk-6LZFZSYY.js";import{S as z,Ta as R,Ua as W,Va as K,h as L,i as U,l as F,w as A,x as j}from"./chunk-2ZZAZF3K.js";import{$ as b,$b as w,Bb as V,Cb as E,Eb as h,Gb as g,Hb as f,Ra as l,Tb as B,Wb as c,Xb as u,Yb as P,_b as y,a as _,ac as k,b as M,bb as I,bc as D,fa as v,ga as C,hb as x,jb as S,jc as a,kc as s,pa as T,ub as d,vb as r,wb as o,xb as O}from"./chunk-MXPEK2PN.js";function ue(p,i){if(p&1){let e=h();V(0),r(1,"div",24),O(2,"i",25),r(3,"div",26),c(4),a(5,"translate"),o(),r(6,"p-button",27),g("onClick",function(){v(e);let n=f();return C(n.addVolume())}),o()(),E()}p&2&&(l(4),u(s(5,1,"VOLUMES.PMT_EMPTY")))}function ge(p,i){if(p&1){let e=h();r(0,"p-card",30)(1,"div",31)(2,"span",32),c(3),o(),r(4,"button",33),g("click",function(){let n=v(e).index,m=f(2);return C(m.removeVolume(n))}),o()(),r(5,"div",34)(6,"div",35)(7,"div",36)(8,"label"),c(9),a(10,"translate"),o(),r(11,"input",37),k("ngModelChange",function(n){let m=v(e).$implicit;return w(m.path,n)||(m.path=n),C(n)}),o()(),r(12,"div",36)(13,"label"),c(14),a(15,"translate"),o(),r(16,"p-select",38),k("ngModelChange",function(n){let m=v(e).$implicit;return w(m.type,n)||(m.type=n),C(n)}),o()()()(),r(17,"div",36)(18,"label"),c(19),a(20,"translate"),o(),r(21,"input",39),k("ngModelChange",function(n){let m=v(e).$implicit;return w(m.description,n)||(m.description=n),C(n)}),o()()()}if(p&2){let e=i.$implicit,t=i.index,n=f(2);l(3),P("Volume ",t+1),l(6),u(s(10,10,"VOLUMES.PATH")),l(2),y("ngModel",e.path),d("readonly",e.isCommon),l(3),u(s(15,12,"VOLUMES.TYPE_VOLUME")),l(2),d("options",n.volumeTypes),y("ngModel",e.type),l(3),u(s(20,14,"VOLUMES.DESC")),l(2),y("ngModel",e.description),d("readonly",e.isCommon)}}function _e(p,i){if(p&1&&(V(0),r(1,"div",28),x(2,ge,22,16,"p-card",29),o(),E()),p&2){let e=f();l(2),d("ngForOf",e.volumes())}}function ve(p,i){if(p&1){let e=h();r(0,"button",40),g("click",function(){let n=v(e).$implicit,m=f();return C(m.addVolume(n))}),r(1,"span",41),c(2),o(),r(3,"span",42),c(4),o()()}if(p&2){let e=i.$implicit,t=f();B("active",t.isCommonActive(e)),d("disabled",t.isCommonActive(e)),l(2),u(e.label),l(2),u(e.sub)}}var se=class p{translate=b(A);dockerService=b(re);router=b(N);baseDockerfile="";volumes=T([]);commonVolumes=[{label:"Donn\xE9es app",sub:"Persistance des donn\xE9es",path:"/app/data",type:"volume"},{label:"Logs",sub:"Logs persistants",path:"/var/log/app",type:"bind"},{label:"Cache temporaire",sub:"Stockage volatile",path:"/tmp/cache",type:"tmpfs"}];volumeTypes=[{label:"Volume nomm\xE9",value:"named"},{label:"Bind mount",value:"bind"},{label:"Tmpfs",value:"tmpfs"}];previous=new S;next=new S;dockerfilePreview=this.dockerService.dockerfilePreview;dockerComposePreview=this.dockerService.composePreview;dockerRunCommand=this.dockerService.cliPreview;addVolume(i){i&&this.isCommonActive(i)||(this.volumes.set([...this.volumes(),i?{path:i.path,type:i.type,description:i.label,isCommon:!0}:{path:"",type:"volume",description:""}]),this.updateAllSignals())}removeVolume(i){let e=[...this.volumes()];e.splice(i,1),this.volumes.set(e),this.updateAllSignals()}isCommonActive(i){return this.volumes().some(e=>e.path===i.path&&e.type===i.type)}updateAllSignals(){this.generateFileFromInstructions(),this.generateComposeFromInstructions(),this.generateCommandFromInstructions()}generateFileFromInstructions(){let i=this.volumes().map(t=>t.path).filter(t=>!!t&&t.trim()!=="");console.log("Mise \xE0 jour des volumes dans le Dockerfile:",i);let e=this.dockerService.dockerfile();this.dockerService.updateDockerfile(M(_({},e||{}),{volumes:i}))}generateComposeFromInstructions(){let i=this.volumes().map(m=>({type:m.type==="tmpfs"?"tmpfs":m.type==="bind"?"bind":"volume",source:m.type!=="tmpfs"?m.path.replace(/\//g,"_").substring(1):void 0,target:m.path})),e=this.volumes().filter(m=>m.type==="volume").reduce((m,pe)=>{let de=pe.path.replace(/\//g,"_").substring(1);return m[de]={driver:"local"},m},{});console.log("Mise \xE0 jour des volumes dans le compose:",e);let t=this.dockerService.compose(),n=_({},t?.services||{});n.web=M(_({},n.web),{volumes:i}),this.dockerService.updateCompose(M(_({},t||{}),{services:n,volumes:e}))}generateCommandFromInstructions(){let i=this.volumes().map(n=>({source:n.type,target:n.path,type:n.type}));console.log("Mise \xE0 jour des volumes dans les commandes CLI:",i);let e=this.dockerService.cli()||{},t=e.runCommands&&e.runCommands.length>0?e.runCommands.map(n=>M(_({},n),{volumes:i})):[{volumes:i}];this.dockerService.updateCLI(M(_({},e),{runCommands:t}))}onCopyDockerfile(){this.dockerfilePreview&&navigator.clipboard.writeText(this.dockerfilePreview())}onDownloadDockerfile(){if(!this.dockerfilePreview)return;let i=new Blob([this.dockerfilePreview()],{type:"text/plain"}),e=window.URL.createObjectURL(i),t=document.createElement("a");t.href=e,t.download="Dockerfile",t.click(),window.URL.revokeObjectURL(e)}onPrevious(){this.previous.emit(),this.router.navigate(["/port-reseau"])}onNext(){this.updateAllSignals(),this.next.emit(),this.router.navigate(["/utilisateurs"])}static \u0275fac=function(e){return new(e||p)};static \u0275cmp=I({type:p,selectors:[["app-volumes"]],inputs:{baseDockerfile:"baseDockerfile"},outputs:{previous:"previous",next:"next"},decls:55,vars:41,consts:[[1,"volume-step"],[1,"step-content"],[1,"left-side"],[1,"section-card","volumes-card"],[1,"card-header"],[1,"pi","pi-database","mat-icon-colored"],[1,"title"],[1,"subtitle"],["label","Ajouter","icon","pi pi-plus","styleClass","p-button-primary",1,"add-btn","btn-blue-right",3,"onClick"],[4,"ngIf"],[1,"section-card","volumes-communs-card"],[1,"volumes-communs-header"],[1,"volumes-communs-subtitle"],[1,"volumes-communs-list"],["type","button","class","common-volume-btn",3,"active","disabled","click",4,"ngFor","ngForOf"],[1,"section-card","infos-volumes-card"],[1,"info","info-blue"],[1,"info","info-green"],[1,"info","info-orange"],[1,"bottom-actions"],["icon","pi pi-arrow-left","severity","secondary",1,"nav-btn","nav-btn-prev",3,"click","label"],["icon","pi pi-arrow-right","iconPos","right",1,"nav-btn","nav-btn-next","btn-blue-right",3,"click","label"],[1,"right-side"],[3,"copy","download","content"],[1,"init-content"],[1,"pi","pi-inbox","mat-icon-colored"],[1,"empty-msg"],["label","Ajouter votre premier volume","icon","pi pi-plus","styleClass","p-button-primary",1,"first-btn","btn-blue-right",3,"onClick"],[1,"volumes-list"],["class","volume-entry-card",4,"ngFor","ngForOf"],[1,"volume-entry-card"],[1,"volume-header"],[1,"volume-tag"],["pButton","","icon","pi pi-trash","aria-label","Supprimer",1,"p-button-rounded","p-button-text",3,"click"],[1,"health-fields"],[1,"form-row"],[1,"form-group"],["pInputText","","placeholder","/app/data",3,"ngModelChange","ngModel","readonly"],[3,"ngModelChange","options","ngModel"],["pInputText","","placeholder","Description",3,"ngModelChange","ngModel","readonly"],["type","button",1,"common-volume-btn",3,"click","disabled"],[1,"label"],[1,"sub"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-card",3)(4,"div",4)(5,"div")(6,"i",5)(7,"span",6),c(8),a(9,"translate"),o()(),r(10,"div",7),c(11),a(12,"translate"),o()(),r(13,"p-button",8),g("onClick",function(){return t.addVolume()}),o()(),x(14,ue,7,3,"ng-container",9)(15,_e,3,1,"ng-container",9),o(),r(16,"p-card",10)(17,"div",11),c(18),a(19,"translate"),o(),r(20,"div",12),c(21),a(22,"translate"),o(),r(23,"div",13),x(24,ve,5,5,"button",14),o()(),r(25,"p-card",15)(26,"div",16)(27,"b"),c(28),a(29,"translate"),o(),O(30,"br"),c(31),a(32,"translate"),o(),r(33,"div",17)(34,"b"),c(35),a(36,"translate"),o(),O(37,"br"),c(38),a(39,"translate"),o(),r(40,"div",18)(41,"b"),c(42,"Tmpfs"),o(),O(43,"br"),c(44),a(45,"translate"),o()(),r(46,"div",19)(47,"p-button",20),a(48,"translate"),g("click",function(){return t.onPrevious()}),o(),r(49,"p-button",21),a(50,"translate"),g("click",function(){return t.onNext()}),o()()(),r(51,"div",22)(52,"dockerfile-preview",23),g("copy",function(){return t.onCopyDockerfile()})("download",function(){return t.onDownloadDockerfile()}),o(),r(53,"docker-compose-preview",23),g("copy",function(){return t.onCopyDockerfile()})("download",function(){return t.onDownloadDockerfile()}),o(),r(54,"docker-command-preview",23),g("copy",function(){return t.onCopyDockerfile()})("download",function(){return t.onDownloadDockerfile()}),o()()()()),e&2&&(l(8),u(s(9,19,"VOLUMES.PMT")),l(3),u(s(12,21,"VOLUMES.PMT_DESC")),l(3),d("ngIf",t.volumes().length===0),l(),d("ngIf",t.volumes().length>0),l(3),u(s(19,23,"VOLUMES.COMMON_VOLUM")),l(3),u(s(22,25,"VOLUMES.ADD_PMT")),l(3),d("ngForOf",t.commonVolumes),l(4),u(s(29,27,"VOLUMES.NANE_VOLUM")),l(3),P(" ",s(32,29,"VOLUMES.VOLUM_DESC")," "),l(4),u(s(36,31,"VOLUMES.BIND_MOUNT")),l(3),P(" ",s(39,33,"VOLUMES.BIND_MOUNT_DESC")," "),l(6),P(" ",s(45,35,"VOLUMES.TMPFS_DESC")," "),l(3),d("label",D(s(48,37,"COMMON.BACK_PORT"))),l(2),d("label",D(s(50,39,"COMMON.NEXT_USER"))),l(3),d("content",t.dockerfilePreview()),l(),d("content",t.dockerComposePreview()),l(),d("content",t.dockerRunCommand()))},dependencies:[F,L,U,z,Y,J,Q,ee,$,Z,q,G,H,X,ie,oe,ne,te,K,R,W,ae,le,me,ce,j],styles:[".volume-step[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:#f7fafd}.volume-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{display:flex;gap:30px;max-width:1200px;margin:0 auto;align-items:flex-start}@media (max-width: 1050px){.volume-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{flex-direction:column}}.volume-step[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]{flex:1.7;min-width:340px;max-width:540px;display:flex;flex-direction:column;gap:22px}.volume-step[_ngcontent-%COMP%]   .right-side[_ngcontent-%COMP%]{flex:2.1;min-width:350px;max-width:650px;gap:10px}.volume-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]{box-shadow:0 2px 12px #0077ee10;border-radius:14px;margin-bottom:0}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding:8px 0 16px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.23rem;font-weight:700;margin-left:8px;color:#193f79}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:1.01rem;color:#41689c;margin-top:-2px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .add-btn[_ngcontent-%COMP%]{min-width:110px;margin-left:20px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .init-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:30px 0 20px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .init-content[_ngcontent-%COMP%]   .init-icon[_ngcontent-%COMP%]{font-size:2.8rem;color:#a3c0ea;margin-bottom:10px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .init-content[_ngcontent-%COMP%]   .empty-msg[_ngcontent-%COMP%]{font-size:1.13rem;color:#678;margin-bottom:18px;margin-top:2px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .init-content[_ngcontent-%COMP%]   .first-btn[_ngcontent-%COMP%]{min-width:270px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volumes-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]{background:#f7fafd;border-radius:10px;margin-bottom:0;padding:16px 14px 10px 16px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .volume-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .volume-header[_ngcontent-%COMP%]   .volume-tag[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:#1976d2;background:#e8f1fc;padding:3px 12px;border-radius:20px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .volume-header[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{color:#de4343!important}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:16px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:8px;display:grid}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#123a66;margin-bottom:1px}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .health-fields[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:6px;flex-wrap:wrap}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .health-fields[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1 1 30%;min-width:0;max-width:100%}.volume-step[_ngcontent-%COMP%]   .volumes-card[_ngcontent-%COMP%]   .volume-entry-card[_ngcontent-%COMP%]   .health-fields[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;min-width:0}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-header[_ngcontent-%COMP%]{font-weight:700;font-size:1.11rem;margin-bottom:2px}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-subtitle[_ngcontent-%COMP%]{font-size:.99rem;color:#567;margin-bottom:9px}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:11px;margin-top:2px}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn[_ngcontent-%COMP%]{border:1px solid #c7dbf7;background:#e9f1fc;border-radius:13px;padding:8px 14px;min-width:110px;text-align:left;transition:background .2s,color .2s;cursor:pointer;display:flex;flex-direction:column}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:700;color:#226edb;font-size:1.03rem}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:.92em;color:#5a7bb6}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn.active[_ngcontent-%COMP%], .volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn[disabled][_ngcontent-%COMP%]{background:#c1d4f2;border-color:#92b4e7;color:#7f8c99;cursor:not-allowed}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn.active[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%], .volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn[disabled][_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#7f8c99}.volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn.active[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%], .volume-step[_ngcontent-%COMP%]   .volumes-communs-card[_ngcontent-%COMP%]   .volumes-communs-list[_ngcontent-%COMP%]   .common-volume-btn[disabled][_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{color:#b5b9be}.volume-step[_ngcontent-%COMP%]   .infos-volumes-card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{border-radius:10px;padding:12px 16px;margin-bottom:10px;font-size:.97rem;line-height:1.5}.volume-step[_ngcontent-%COMP%]   .infos-volumes-card[_ngcontent-%COMP%]   .info.info-blue[_ngcontent-%COMP%]{background:#eaf5ff;border-left:4px solid #64b6f7}.volume-step[_ngcontent-%COMP%]   .infos-volumes-card[_ngcontent-%COMP%]   .info.info-green[_ngcontent-%COMP%]{background:#e7fceb;border-left:4px solid #6ec296}.volume-step[_ngcontent-%COMP%]   .infos-volumes-card[_ngcontent-%COMP%]   .info.info-orange[_ngcontent-%COMP%]{background:#fff4e4;border-left:4px solid #f7b963}.volume-step[_ngcontent-%COMP%]   .bottom-actions[_ngcontent-%COMP%]{margin-top:24px;display:flex;justify-content:space-between;gap:20px}"],changeDetection:0})};export{se as VolumesComponent};
