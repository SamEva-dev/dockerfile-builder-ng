import{a as ce,b as se}from"./chunk-MJQ3KY2W.js";import{a as q,b as J,c as Q}from"./chunk-ZXMRF2QA.js";import"./chunk-NNZJJLOA.js";import{a as Z,b as ee,c as ae,d as pe,e as le}from"./chunk-UHGY6NSJ.js";import{a as G,b as re}from"./chunk-YUABFYP2.js";import{c as j,d as H,e as $,g as X,i as te,j as ie,k as ne,l as oe}from"./chunk-X2UVP5SW.js";import"./chunk-G2M2UXHZ.js";import"./chunk-HEVQ3NIT.js";import"./chunk-Z7WK5Y2H.js";import{b as B}from"./chunk-6LZFZSYY.js";import{Da as V,R as L,S as F,Ta as W,Ua as z,Va as K,h as A,l as N,w as U,x as Y}from"./chunk-2ZZAZF3K.js";import{$ as x,$b as T,Eb as k,Gb as m,Hb as O,Ra as n,Wb as a,Xb as _,Yb as v,_b as I,a as C,ac as w,b as E,bb as R,bc as y,fa as S,ga as M,hb as P,jb as h,jc as p,kc as l,pa as f,ub as d,vb as i,wb as t,xb as b}from"./chunk-MXPEK2PN.js";function _e(u,c){u&1&&(i(0,"mat-icon"),a(1,"security"),t(),a(2),p(3,"translate")),u&2&&(n(2),v(" ",l(3,1,"SECURITY.BASE_TITLE")," "))}function ue(u,c){u&1&&(i(0,"mat-icon"),a(1,"tune"),t(),a(2),p(3,"translate")),u&2&&(n(2),v(" ",l(3,1,"SECURITY.CAP_TITLE")," "))}function ge(u,c){if(u&1){let r=k();i(0,"div",36)(1,"p-select",37),w("ngModelChange",function(o){let s=S(r).$implicit;return T(s.type,o)||(s.type=o),M(o)}),m("ngModelChange",function(){S(r);let o=O();return M(o.updateAllSignals())}),t(),i(2,"p-select",38),p(3,"translate"),w("ngModelChange",function(o){let s=S(r).$implicit;return T(s.name,o)||(s.name=o),M(o)}),m("ngModelChange",function(){S(r);let o=O();return M(o.updateAllSignals())}),t(),i(4,"button",39),m("click",function(){let o=S(r).index,s=O();return M(s.removeCapability(o))}),t()()}if(u&2){let r=c.$implicit,e=O();n(),d("options",e.capabilityTypes),I("ngModel",r.type),n(),d("placeholder",y(l(3,6,"SECURITY.CAP_SELECT")))("options",e.capabilityOptions),I("ngModel",r.name)}}var de=class u{translate=x(U);dockerService=x(re);router=x(B);capabilityTypes=[{label:"ADD (ajouter)",value:"ADD"},{label:"DROP (retirer)",value:"DROP"}];allCapabilities=["AUDIT_CONTROL","AUDIT_WRITE","BLOCK_SUSPEND","CHOWN","DAC_OVERRIDE","DAC_READ_SEARCH","FOWNER","FSETID","IPC_LOCK","IPC_OWNER","KILL","LEASE","LINUX_IMMUTABLE","MAC_ADMIN","MAC_OVERRIDE","MKNOD","NET_ADMIN","NET_BIND_SERVICE","NET_BROADCAST","NET_RAW","SETFCAP","SETGID","SETPCAP","SETUID","SYS_ADMIN","SYS_BOOT","SYS_CHROOT","SYS_MODULE","SYS_NICE","SYS_PACCT","SYS_PTRACE","SYS_RAWIO","SYS_RESOURCE","SYS_TIME","SYS_TTY_CONFIG","SYSLOG","WAKE_ALARM"];readOnlyRoot=f(!1);noNewPrivs=f(!1);capabilities=f([]);capabilityOptions=[{label:"NET_BIND_SERVICE",value:"NET_BIND_SERVICE"},{label:"SYS_ADMIN",value:"SYS_ADMIN"},{label:"CHOWN",value:"CHOWN"},{label:"SETUID",value:"SETUID"},{label:"SETGID",value:"SETGID"},{label:"KILL",value:"KILL"},{label:"AUDIT_WRITE",value:"AUDIT_WRITE"}];seccomp=f("default");apparmor=f("");selinux=f("");previous=new h;next=new h;dockerfilePreview=this.dockerService.dockerfilePreview;dockerComposePreview=this.dockerService.composePreview;dockerRunCommand=this.dockerService.cliPreview;addCapability(){this.capabilities.set([...this.capabilities(),{type:"add",name:"NET_BIND_SERVICE"}]),this.updateAllSignals()}removeCapability(c){let r=[...this.capabilities()];r.splice(c,1),this.capabilities.set(r),this.updateAllSignals()}updateAllSignals(){this.generateFileFromInstructions(),this.generateComposeFromInstructions(),this.generateCommandFromInstructions()}generateFileFromInstructions(){let c=this.dockerService.dockerfile(),r={readOnlyRoot:this.readOnlyRoot(),noNewPrivs:this.noNewPrivs(),capabilities:this.capabilities().map(e=>({type:e.type.toLowerCase(),name:e.name})),seccomp:this.seccomp(),apparmor:this.apparmor(),selinux:this.selinux()};this.dockerService.updateDockerfile(E(C({},c||{}),{security:r}))}generateComposeFromInstructions(){let c=this.dockerService.compose(),r=C({},c?.services||{});r.web=E(C({},r.web),{read_only:this.readOnlyRoot(),security_opt:[...this.noNewPrivs()?["no-new-privileges:true"]:[],...this.seccomp()?[`seccomp:${this.seccomp()}`]:[],...this.apparmor()?[`apparmor:${this.apparmor()}`]:[],...this.selinux()?[`selinux:${this.selinux()}`]:[]].filter(Boolean),cap_add:this.capabilities().filter(e=>e.type==="add").map(e=>e.name),cap_drop:this.capabilities().filter(e=>e.type==="drop").map(e=>e.name)}),this.dockerService.updateCompose(E(C({},c||{}),{services:r}))}generateCommandFromInstructions(){let c=this.dockerService.cli()||{},r=[...this.noNewPrivs()?["no-new-privileges:true"]:[],...this.seccomp()?[`seccomp=${this.seccomp()}`]:[],...this.apparmor()?[`apparmor=${this.apparmor()}`]:[],...this.selinux()?[`label=${this.selinux()}`]:[]].filter(Boolean),e=this.capabilities().filter(g=>g.type==="add").map(g=>g.name),o=this.capabilities().filter(g=>g.type==="drop").map(g=>g.name),s=this.readOnlyRoot(),D={securityOpt:r,capAdd:e,capDrop:o,readOnly:s},me=c.runCommands&&c.runCommands.length>0?c.runCommands.map(g=>C(C({},g),D)):[D];this.dockerService.updateCLI(E(C({},c),{runCommands:me}))}onCopyDockerfile(){this.dockerfilePreview&&navigator.clipboard.writeText(this.dockerfilePreview())}onDownloadDockerfile(){if(!this.dockerfilePreview)return;let c=new Blob([this.dockerfilePreview()],{type:"text/plain"}),r=window.URL.createObjectURL(c),e=document.createElement("a");e.href=r,e.download="Dockerfile",e.click(),window.URL.revokeObjectURL(r)}onPrevious(){this.previous.emit()}onNext(){this.updateAllSignals(),this.next.emit(),this.router.navigate(["/apercu"])}static \u0275fac=function(r){return new(r||u)};static \u0275cmp=R({type:u,selectors:[["app-securite"]],outputs:{previous:"previous",next:"next"},decls:95,vars:69,consts:[[1,"security-step"],[1,"step-content"],[1,"left-side"],[1,"alert-security-red"],[1,"icon"],[1,"title"],[1,"desc"],[1,"section-card","base-options-card"],["pTemplate","title"],[1,"subtitle"],[1,"options-list"],["binary","true",3,"ngModelChange","ngModel"],[1,"section-card","caps-card"],[1,"cap-list"],["class","cap-row",4,"ngFor","ngForOf"],[1,"btn-row"],["icon","pi pi-plus",1,"btn-blue-right",3,"onClick","label"],[1,"section-card","profiles-card"],[1,"profiles-title"],[1,"profiles-desc"],[1,"profiles-list"],[1,"profile-row"],["pInputText","","placeholder","default profil seccomp",3,"ngModelChange","ngModel"],["pInputText","","placeholder","profil apparmor",3,"ngModelChange","ngModel"],["pInputText","","placeholder","option selinux",3,"ngModelChange","ngModel"],[1,"section-card","recommendations-card"],[1,"rec-title"],[1,"rec-desc"],[1,"rec-tip","rec-green"],[1,"rec-tip","rec-blue"],[1,"rec-tip","rec-orange"],[1,"bottom-actions"],["icon","pi pi-arrow-left","severity","secondary",1,"nav-btn","nav-btn-prev",3,"click","label"],["icon","pi pi-arrow-right","iconPos","right",1,"nav-btn","nav-btn-next","btn-blue-right",3,"click","label"],[1,"right-side"],[3,"copy","download","content"],[1,"cap-row"],[1,"cap-type-select",3,"ngModelChange","options","ngModel"],[1,"cap-name-select",3,"ngModelChange","options","ngModel","placeholder"],["pButton","","pRipple","","type","button","icon","pi pi-trash","aria-label","Supprimer",1,"p-button-text","p-button-rounded","delete-btn",3,"click"]],template:function(r,e){r&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),a(5,"error_outline"),t(),i(6,"div")(7,"div",5),a(8),p(9,"translate"),t(),i(10,"div",6),a(11),p(12,"translate"),t()()(),i(13,"p-card",7),P(14,_e,4,3,"ng-template",8),i(15,"div",9),a(16),p(17,"translate"),t(),i(18,"div",10)(19,"p-toggleswitch",11),m("ngModelChange",function(s){return e.readOnlyRoot.set(s),e.updateAllSignals()}),t(),i(20,"label"),a(21),p(22,"translate"),t(),b(23,"br"),i(24,"p-toggleswitch",11),m("ngModelChange",function(s){return e.noNewPrivs.set(s),e.updateAllSignals()}),t(),i(25,"label"),a(26),p(27,"translate"),t()()(),i(28,"p-card",12),P(29,ue,4,3,"ng-template",8),i(30,"div",9),a(31),p(32,"translate"),t(),i(33,"div",13),P(34,ge,5,8,"div",14),t(),i(35,"div",15)(36,"p-button",16),p(37,"translate"),m("onClick",function(){return e.addCapability()}),t()()(),i(38,"p-card",17)(39,"div",18),a(40),p(41,"translate"),t(),i(42,"div",19),a(43),p(44,"translate"),t(),i(45,"div",20)(46,"div",21)(47,"label"),a(48,"Profil Seccomp"),t(),i(49,"input",22),m("ngModelChange",function(s){return e.seccomp.set(s),e.updateAllSignals()}),t()(),i(50,"div",21)(51,"label"),a(52,"Profil AppArmor"),t(),i(53,"input",23),m("ngModelChange",function(s){return e.apparmor.set(s),e.updateAllSignals()}),t()(),i(54,"div",21)(55,"label"),a(56,"Options SELinux"),t(),i(57,"input",24),m("ngModelChange",function(s){return e.selinux.set(s),e.updateAllSignals()}),t()()()(),i(58,"p-card",25)(59,"div",26),a(60),p(61,"translate"),t(),i(62,"div",27),a(63),p(64,"translate"),t(),i(65,"div",28)(66,"b"),a(67),p(68,"translate"),t(),b(69,"br"),a(70),p(71,"translate"),t(),i(72,"div",29)(73,"b"),a(74),p(75,"translate"),t(),b(76,"br"),a(77),p(78,"translate"),t(),i(79,"div",30)(80,"b"),a(81),p(82,"translate"),t(),b(83,"br"),a(84),p(85,"translate"),t()(),i(86,"div",31)(87,"p-button",32),p(88,"translate"),m("click",function(){return e.onPrevious()}),t(),i(89,"p-button",33),p(90,"translate"),m("click",function(){return e.onNext()}),t()()(),i(91,"div",34)(92,"dockerfile-preview",35),m("copy",function(){return e.onCopyDockerfile()})("download",function(){return e.onDownloadDockerfile()}),t(),i(93,"docker-compose-preview",35),m("copy",function(){return e.onCopyDockerfile()})("download",function(){return e.onDownloadDockerfile()}),t(),i(94,"docker-command-preview",35),m("copy",function(){return e.onCopyDockerfile()})("download",function(){return e.onDownloadDockerfile()}),t()()()()),r&2&&(n(8),_(l(9,31,"SECURITY.NOTE_TITLE")),n(3),_(l(12,33,"SECURITY.NOTE_MSG")),n(5),_(l(17,35,"SECURITY.BASE_DESC")),n(3),d("ngModel",e.readOnlyRoot()),n(2),_(l(22,37,"SECURITY.READONLY")),n(3),d("ngModel",e.noNewPrivs()),n(2),_(l(27,39,"SECURITY.NONEWPRIV")),n(5),_(l(32,41,"SECURITY.CAP_DESC")),n(3),d("ngForOf",e.capabilities()),n(2),d("label",y(l(37,43,"SECURITY.CAP_ADD"))),n(4),_(l(41,45,"SECURITY.PROFILE_TITLE")),n(3),_(l(44,47,"SECURITY.PROFILE_DESC")),n(6),d("ngModel",e.seccomp()),n(4),d("ngModel",e.apparmor()),n(4),d("ngModel",e.selinux()),n(3),_(l(61,49,"SECURITY.RECO_TITLE")),n(3),_(l(64,51,"SECURITY.RECO_DESC")),n(4),_(l(68,53,"SECURITY.RECO_PRIV")),n(3),v(" ",l(71,55,"SECURITY.RECO_PRIV_DESC")," "),n(4),_(l(75,57,"SECURITY.RECO_FS")),n(3),v(" ",l(78,59,"SECURITY.RECO_FS_DESC")," "),n(4),_(l(82,61,"SECURITY.RECO_AUDIT")),n(3),v(" ",l(85,63,"SECURITY.RECO_AUDIT_DESC")," "),n(3),d("label",y(l(88,65,"COMMON.BACK_USER"))),n(2),d("label",y(l(90,67,"COMMON.NEXT_REVIEW"))),n(3),d("content",e.dockerfilePreview()),n(),d("content",e.dockerComposePreview()),n(),d("content",e.dockerRunCommand()))},dependencies:[N,A,F,L,G,q,J,ee,Z,V,Q,X,j,H,$,oe,ne,ie,te,K,W,z,se,ce,ae,pe,le,Y],styles:[".security-step[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:#f7fafd}.security-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{display:flex;gap:30px;max-width:1200px;margin:0 auto;align-items:flex-start}@media (max-width: 1050px){.security-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{flex-direction:column}}.security-step[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]{flex:1.7;min-width:340px;max-width:540px;display:flex;flex-direction:column;gap:22px}.security-step[_ngcontent-%COMP%]   .right-side[_ngcontent-%COMP%]{flex:2.1;min-width:350px;max-width:650px;gap:10px}.security-step[_ngcontent-%COMP%]   .alert-security-red[_ngcontent-%COMP%]{background:#fff3f3;border:1.5px solid #f5b3b3;border-radius:12px;display:flex;gap:18px;align-items:flex-start;padding:18px 22px;margin-bottom:15px}.security-step[_ngcontent-%COMP%]   .alert-security-red[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:#d43f3f;font-size:2rem;margin-right:5px}.security-step[_ngcontent-%COMP%]   .alert-security-red[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#c34e06;font-weight:600;font-size:1.17rem;margin-bottom:2px}.security-step[_ngcontent-%COMP%]   .alert-security-red[_ngcontent-%COMP%]   .desc[_ngcontent-%COMP%]{color:#b03400}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]{box-shadow:0 2px 12px #0077ee10;border-radius:14px;margin-bottom:0}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#496ab1;font-size:1rem;margin-bottom:10px}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .options-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:10px}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .cap-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-bottom:5px}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .cap-row[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{color:#de4343!important}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .btn-row[_ngcontent-%COMP%]{margin-top:7px}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .profiles-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.07rem;margin-bottom:2px}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .profiles-desc[_ngcontent-%COMP%]{font-size:.98rem;color:#567;margin-bottom:10px}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .profiles-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.security-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .profile-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3px}.security-step[_ngcontent-%COMP%]   .recommendations-card[_ngcontent-%COMP%]   .rec-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.11rem;margin-bottom:2px}.security-step[_ngcontent-%COMP%]   .recommendations-card[_ngcontent-%COMP%]   .rec-desc[_ngcontent-%COMP%]{font-size:.99rem;color:#567;margin-bottom:10px}.security-step[_ngcontent-%COMP%]   .recommendations-card[_ngcontent-%COMP%]   .rec-tip[_ngcontent-%COMP%]{border-radius:10px;padding:10px 14px;margin-bottom:7px;font-size:.96rem;line-height:1.45}.security-step[_ngcontent-%COMP%]   .recommendations-card[_ngcontent-%COMP%]   .rec-tip.rec-green[_ngcontent-%COMP%]{background:#e7fceb;border-left:4px solid #6ec296}.security-step[_ngcontent-%COMP%]   .recommendations-card[_ngcontent-%COMP%]   .rec-tip.rec-blue[_ngcontent-%COMP%]{background:#eaf5ff;border-left:4px solid #64b6f7}.security-step[_ngcontent-%COMP%]   .recommendations-card[_ngcontent-%COMP%]   .rec-tip.rec-orange[_ngcontent-%COMP%]{background:#fff4e4;border-left:4px solid #f7b963}.security-step[_ngcontent-%COMP%]   .bottom-actions[_ngcontent-%COMP%]{margin-top:26px;display:flex;justify-content:space-between;gap:20px}"],changeDetection:0})};export{de as SecuriteComponent};
