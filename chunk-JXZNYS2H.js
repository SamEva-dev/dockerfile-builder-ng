import{a as $,b as tt,c as ot,d as rt,e as ct}from"./chunk-UHGY6NSJ.js";import{b as it}from"./chunk-YUABFYP2.js";import{c as q,d as J,e as Q,g as Z,k as et,l as nt}from"./chunk-X2UVP5SW.js";import"./chunk-G2M2UXHZ.js";import"./chunk-HEVQ3NIT.js";import"./chunk-Z7WK5Y2H.js";import{b as L}from"./chunk-6LZFZSYY.js";import{Da as j,S as G,Ta as K,Ua as X,Va as H,h as A,i as Y,l as F,w as W,x as z}from"./chunk-2ZZAZF3K.js";import{$ as y,$b as b,Bb as V,Cb as B,Eb as S,Gb as _,Hb as m,Ra as i,Wb as g,Xb as I,Yb as w,Zb as U,_b as N,a as T,ac as h,b as P,bb as R,bc as O,cc as v,fa as C,ga as f,hb as M,jb as E,jc as l,kc as d,pa as k,ub as a,vb as o,wb as c,xb as D}from"./chunk-MXPEK2PN.js";function at(s,r){if(s&1){let t=S();o(0,"div",12)(1,"i",13)(2,"span",14),g(3),l(4,"translate"),c()(),o(5,"span",15),g(6),l(7,"translate"),c()(),o(8,"p-button",16),l(9,"translate"),_("onClick",function(){C(t);let e=m();return f(e.addInstruction())}),c()}s&2&&(i(3),I(d(4,4,"INSTRUCTION.TITLE")),i(3),w("",d(7,6,"INSTRUCTION.DESC")," "),i(2),a("label",O(d(9,8,"INSTRUCTION.ADD"))))}function pt(s,r){if(s&1){let t=S();o(0,"div",17)(1,"div"),D(2,"i",18),c(),o(3,"p",19),g(4),l(5,"translate"),c(),o(6,"p-button",20),l(7,"translate"),_("onClick",function(){C(t);let e=m();return f(e.addInstruction())}),c()()}s&2&&(i(4),w(" ",d(5,3,"INSTRUCTION.EMPTY")," "),i(2),a("label",O(d(7,5,"INSTRUCTION.ADD_FIRST"))))}function lt(s,r){if(s&1){let t=S();o(0,"span",30),g(1),l(2,"translate"),c(),o(3,"button",31),_("click",function(){C(t);let e=m().index,p=m(2);return f(p.removeInstruction(e))}),c()}if(s&2){let t=m().index;i(),U("",d(2,2,"INSTRUCTION.STEP")," ",t+1)}}function dt(s,r){if(s&1&&(o(0,"div")(1,"span"),g(2),c(),o(3,"span",32),g(4),l(5,"translate"),c()()),s&2){let t=r.$implicit;i(2),I(t.label),i(2),I(d(5,2,t.desc))}}function mt(s,r){if(s&1){let t=S();o(0,"p-card",23),M(1,lt,4,4,"ng-template",4),o(2,"div",24)(3,"label",25),g(4),l(5,"translate"),c(),o(6,"p-select",26),h("ngModelChange",function(e){let p=C(t).index,u=m(2);return b(u.instructions()[p].type,e)||(u.instructions()[p].type=e),f(e)}),M(7,dt,6,4,"ng-template",27),c(),o(8,"label",25),g(9),l(10,"translate"),c(),o(11,"input",28),h("ngModelChange",function(e){let p=C(t).index,u=m(2);return b(u.instructions()[p].content,e)||(u.instructions()[p].content=e),f(e)}),_("ngModelChange",function(){C(t);let e=m(2);return f(e.onInstructionChange())}),c(),o(12,"label",25),g(13),l(14,"translate"),c(),o(15,"input",29),l(16,"translate"),h("ngModelChange",function(e){let p=C(t).index,u=m(2);return b(u.instructions()[p].description,e)||(u.instructions()[p].description=e),f(e)}),_("ngModelChange",function(){C(t);let e=m(2);return f(e.onInstructionChange())}),c()()()}if(s&2){let t=r.index,n=m(2);i(3),a("for",v("type-",t)),i(),I(d(5,22,"INSTRUCTION.TYPE")),i(2),a("id",v("type-",t))("options",n.instructionTypes),N("ngModel",n.instructions()[t].type),a("filter",!0),i(2),a("for",v("content-",t)),i(),I(d(10,24,"INSTRUCTION.CONTENT")),i(2),a("id",v("content-",t)),N("ngModel",n.instructions()[t].content),i(),a("for",v("desc-",t)),i(),I(d(14,26,"INSTRUCTION.DESCRIPTION")),i(2),a("id",v("desc-",t))("placeholder",O(d(16,28,"INSTRUCTION.DESCRIPTION_PLACEHOLDER"))),N("ngModel",n.instructions()[t].description)}}function ut(s,r){if(s&1&&(V(0),o(1,"div",21),M(2,mt,17,30,"p-card",22),c(),B()),s&2){let t=m();i(2),a("ngForOf",t.instructions())}}var _t=[{value:"RUN",label:"RUN",desc:"INSTRUCTION.TYPE_RUN"},{value:"COPY",label:"COPY",desc:"INSTRUCTION.TYPE_COPY"},{value:"ADD",label:"ADD",desc:"INSTRUCTION.TYPE_ADD"},{value:"ENV",label:"ENV",desc:"INSTRUCTION.TYPE_ENV"},{label:"VARENV",value:"VARENV",desc:"INSTRUCTION.TYPE_VARENV"},{value:"WORKDIR",label:"WORKDIR",desc:"INSTRUCTION.TYPE_WORKDIR"},{value:"EXPOSE",label:"EXPOSE",desc:"INSTRUCTION.TYPE_EXPOSE"},{value:"LABEL",label:"LABEL",desc:"INSTRUCTION.TYPE_LABEL"},{label:"CMD",value:"CMD",desc:"INSTRUCTION.TYPE_CMD"},{label:"ENTRYPOINT",value:"ENTRYPOINT",desc:"INSTRUCTION.TYPE_ENTRYPOINT"},{label:"ARG",value:"ARG",desc:"INSTRUCTION.TYPE_ARG"},{label:"USER",value:"USER",desc:"INSTRUCTION.TYPE_USER"}],st=class s{translate=y(W);dockerService=y(it);router=y(L);instructions=k([]);instructionTypes=_t;previous=new E;next=new E;dockerfilePreview=this.dockerService.dockerfilePreview;dockerComposePreview=this.dockerService.composePreview;dockerRunCommand=this.dockerService.cliPreview;addInstruction(){this.instructions.set([...this.instructions(),{type:"RUN",content:"",description:""}]),this.updateDockerfileSignal()}removeInstruction(r){let t=[...this.instructions()];t.splice(r,1),this.instructions.set(t),this.updateDockerfileSignal()}onInstructionChange(){this.updateDockerfileSignal()}onCopyDockerfile(){}onDownloadDockerfile(){}updateDockerfileSignal(){this.generateFileFromInstructions(this.instructions()),this.generateComposeFromInstructions(this.instructions()),this.generateCommandFromInstructions(this.instructions())}generateFileFromInstructions(r){let t=this.dockerService.dockerfile();console.log("Mise \xE0 jour Dockerfile avec instructions:",t),this.dockerService.updateDockerfile(P(T({},t||{}),{install:{type:"custom",commands:r.filter(n=>!!n.content).map(n=>this.getInstructionString(n))}}))}generateComposeFromInstructions(r){let t={context:"./web"},n=this.dockerService.compose()??{version:"3.8",services:{}};t.args=r.filter(x=>["ARG","ENV","VARENV"].includes(x.type)).map(x=>x.content.trim());let e=this.dockerService.dockerfile(),p={build:t,image:e?.baseImage,environment:t.args},u=P(T({},n),{services:P(T({},n.services),{app:p})});this.dockerService.updateCompose(u)}generateCommandFromInstructions(r){let t=this.dockerService.cli(),n=r.filter(e=>["ARG","ENV","VARENV"].includes(e.type)).reduce((e,p)=>{let[u,x]=p.content.split("=");return e[u.trim()]=x?.trim()??"",e},{});this.dockerService.updateCLI(P(T({},t),{buildCommands:[{buildArgs:n}]}))}getInstructionString(r){return r.description?`${r.type} ${r.content} # ${r.description}`:`${r.type} ${r.content}`}onPrevious(){this.previous.emit(),this.router.navigate(["/base-image"])}onNext(){this.updateDockerfileSignal(),this.next.emit(),this.router.navigate(["/configuration"])}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=R({type:s,selectors:[["app-instruction"]],outputs:{previous:"previous",next:"next"},decls:16,vars:13,consts:[[1,"instruction-step"],[1,"step-content"],[1,"left-side"],[1,"initial-card"],["pTemplate","title"],["class","empty-list",4,"ngIf"],[4,"ngIf"],[1,"step-navigation"],["icon","pi pi-arrow-left","severity","secondary",1,"nav-btn","nav-btn-prev",3,"click","label"],["icon","pi pi-arrow-right","iconPos","right",1,"nav-btn","nav-btn-next","btn-blue-right",3,"click","label"],[1,"right-side"],[3,"copy","download","content"],[1,"title",2,"display","grid"],[1,"pi","pi-play","mat-icon-bordered-outline",2,"font-size","1.4rem"],[1,"instruct-title"],[1,"subtitle"],["icon","pi pi-plus","styleClass","p-button-primary",1,"btn-blue-right",3,"onClick","label"],[1,"empty-list"],[1,"pi","pi-code",2,"font-size","30px"],[2,"margin-bottom","16px"],["icon","pi pi-plus",1,"btn-blue-right",3,"onClick","label"],[1,"instructions-list"],["class","instruction-card",4,"ngFor","ngForOf"],[1,"instruction-card"],[1,"form-vertical"],[3,"for"],["optionLabel","label","optionValue","value","placeholder","S\xE9lectionner une instruction",1,"w-full","md:w-56",3,"ngModelChange","id","options","ngModel","filter"],["pTemplate","item"],["pInputText","","autocomplete","off","placeholder","/app, NODE_ENV=dev, etc.",3,"ngModelChange","id","ngModel"],["pInputText","","autocomplete","off",3,"ngModelChange","id","ngModel","placeholder"],[1,"step-tag"],["pButton","","pRipple","","type","button","icon","pi pi-trash","aria-label","Supprimer",1,"p-button-text","p-button-rounded","delete-btn",3,"click"],[1,"item-desc"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-card",3),M(4,at,10,10,"ng-template",4)(5,pt,8,7,"div",5)(6,ut,3,1,"ng-container",6),c(),o(7,"div",7)(8,"p-button",8),l(9,"translate"),_("click",function(){return n.onPrevious()}),c(),o(10,"p-button",9),l(11,"translate"),_("click",function(){return n.onNext()}),c()()(),o(12,"div",10)(13,"dockerfile-preview",11),_("copy",function(){return n.onCopyDockerfile()})("download",function(){return n.onDownloadDockerfile()}),c(),o(14,"docker-compose-preview",11),_("copy",function(){return n.onCopyDockerfile()})("download",function(){return n.onDownloadDockerfile()}),c(),o(15,"docker-command-preview",11),_("copy",function(){return n.onCopyDockerfile()})("download",function(){return n.onDownloadDockerfile()}),c()()()()),t&2&&(i(5),a("ngIf",n.instructions.length===0),i(),a("ngIf",n.instructions().length>0),i(2),a("label",O(d(9,9,"COMMON.BACK_BASE"))),i(2),a("label",O(d(11,11,"COMMON.NEXT_CONFIG"))),i(3),a("content",n.dockerfilePreview()),i(),a("content",n.dockerComposePreview()),i(),a("content",n.dockerRunCommand()))},dependencies:[F,A,Y,Z,q,J,Q,G,H,K,X,j,nt,et,tt,$,ot,rt,ct,z],styles:[".instruction-step[_ngcontent-%COMP%]{width:100%;padding:2rem 0 0;min-height:100vh;background:#f7fafd}.instruction-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{display:flex;gap:32px;max-width:1200px;margin:0 auto;align-items:flex-start;justify-content:center}@media (max-width: 1050px){.instruction-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:20px}}.instruction-step[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]{flex:1.7;min-width:320px;max-width:520px;display:flex;flex-direction:column;gap:20px}.instruction-step[_ngcontent-%COMP%]   .right-side[_ngcontent-%COMP%]{flex:2.2;min-width:340px;max-width:650px;display:flex;flex-direction:column;justify-content:flex-start;gap:10px}.instruction-step[_ngcontent-%COMP%]   .instructions-header[_ngcontent-%COMP%]{margin-bottom:0}.instruction-step[_ngcontent-%COMP%]   .instructions-header[_ngcontent-%COMP%]   .p-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.instruction-step[_ngcontent-%COMP%]   .instructions-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#3d62a5;font-size:1rem;margin-left:6px;margin-bottom:.6rem}.instruction-step[_ngcontent-%COMP%]   .initial-card[_ngcontent-%COMP%]   .p-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.instruction-step[_ngcontent-%COMP%]   .empty-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:30px 0 12px}.instruction-step[_ngcontent-%COMP%]   .empty-list[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-bottom:12px}.instruction-step[_ngcontent-%COMP%]   .empty-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.08rem;color:#55678d;text-align:center}.instruction-step[_ngcontent-%COMP%]   .instructions-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-bottom:6px}.instruction-step[_ngcontent-%COMP%]   .instruction-card[_ngcontent-%COMP%]{margin-bottom:0}.instruction-step[_ngcontent-%COMP%]   .instruction-card[_ngcontent-%COMP%]   .step-tag[_ngcontent-%COMP%]{font-size:1.01rem;font-weight:600;color:#1976d2;padding:3px 12px;border-radius:20px;margin-right:8px;letter-spacing:.1em}.instruction-step[_ngcontent-%COMP%]   .instruction-card[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{float:right;color:#de4343!important;margin-left:auto}.instruction-step[_ngcontent-%COMP%]   .instruction-card[_ngcontent-%COMP%]   .form-vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:9px}.instruction-step[_ngcontent-%COMP%]   .instruction-card[_ngcontent-%COMP%]   .form-vertical[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#123a66;margin-bottom:1px;margin-top:5px}.instruction-step[_ngcontent-%COMP%]   .instruction-card[_ngcontent-%COMP%]   .form-vertical[_ngcontent-%COMP%]   input[pInputText][_ngcontent-%COMP%], .instruction-step[_ngcontent-%COMP%]   .instruction-card[_ngcontent-%COMP%]   .form-vertical[_ngcontent-%COMP%]   p-select[_ngcontent-%COMP%]{width:100%;min-height:38px}.instruction-step[_ngcontent-%COMP%]   .instruction-card[_ngcontent-%COMP%]   .form-vertical[_ngcontent-%COMP%]   .item-desc[_ngcontent-%COMP%]{display:block;font-size:.92em;color:#6f7ba3}.instruction-step[_ngcontent-%COMP%]   .bottom-actions[_ngcontent-%COMP%]{margin-top:24px;display:flex;justify-content:flex-end;gap:16px}.instruction-step[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:gray;font-size:1rem;margin-left:6px;margin-bottom:.6rem}.instruction-step[_ngcontent-%COMP%]   .instruct-title[_ngcontent-%COMP%]{color:#000}[_nghost-%COMP%]     .p-card-title.ng-star-inserted{display:flex!important;justify-content:space-between!important}"],changeDetection:0})};export{st as InstructionComponent};
