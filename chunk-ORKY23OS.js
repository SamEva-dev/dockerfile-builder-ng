import{a as se,b as de}from"./chunk-MJQ3KY2W.js";import{a as J,b as Q,c as Z}from"./chunk-ZXMRF2QA.js";import"./chunk-NNZJJLOA.js";import{a as $,b as ee,c as ae,d as le,e as pe}from"./chunk-UHGY6NSJ.js";import{a as U,b as re}from"./chunk-YUABFYP2.js";import{c as K,d as z,e as X,f as Y,g as q,i as te,j as ne,k as ie,l as oe}from"./chunk-X2UVP5SW.js";import"./chunk-G2M2UXHZ.js";import"./chunk-HEVQ3NIT.js";import"./chunk-Z7WK5Y2H.js";import{b as B}from"./chunk-6LZFZSYY.js";import{Da as G,R as F,S as A,Ta as R,Ua as H,Va as j,h as V,i as N,l as L,w as D,x as W}from"./chunk-2ZZAZF3K.js";import{$ as I,$b as f,Eb as T,Gb as d,Hb as _,Ra as a,Wb as p,Xb as C,Yb as k,_b as h,a as y,ac as v,b as S,bb as P,bc as E,fa as m,ga as u,hb as x,jb as O,jc as c,kc as g,pa as M,ub as w,vb as o,wb as r}from"./chunk-MXPEK2PN.js";function ge(s,l){s&1&&(o(0,"span",23)(1,"mat-icon"),p(2,"settings"),r()(),p(3),c(4,"translate")),s&2&&(a(3),k(" ",g(4,1,"CONFIG.BASE.TITLE")," "))}function me(s,l){s&1&&(o(0,"span",23)(1,"mat-icon"),p(2,"tune"),r()(),p(3),c(4,"translate")),s&2&&(a(3),k(" ",g(4,1,"CONFIG.ENV.TITLE")," "))}function ue(s,l){if(s&1){let n=T();o(0,"div",24)(1,"input",25),v("ngModelChange",function(e){let i=m(n).$implicit;return f(i.key,e)||(i.key=e),u(e)}),d("ngModelChange",function(){m(n);let e=_();return u(e.onInstructionChange())}),r(),o(2,"span"),p(3,"="),r(),o(4,"input",26),v("ngModelChange",function(e){let i=m(n).$implicit;return f(i.value,e)||(i.value=e),u(e)}),d("ngModelChange",function(){m(n);let e=_();return u(e.onInstructionChange())}),r(),o(5,"button",27),d("click",function(){let e=m(n).index,i=_();return u(i.removeEnv(e))}),r()()}if(s&2){let n=l.$implicit;a(),h("ngModel",n.key),a(3),h("ngModel",n.value)}}function _e(s,l){s&1&&(o(0,"span",23)(1,"mat-icon"),p(2,"label"),r()(),p(3),c(4,"translate")),s&2&&(a(3),k(" ",g(4,1,"CONFIG.LABEL.TITLE")," "))}function Ce(s,l){if(s&1){let n=T();o(0,"div",24)(1,"input",28),v("ngModelChange",function(e){let i=m(n).$implicit;return f(i.key,e)||(i.key=e),u(e)}),d("ngModelChange",function(){m(n);let e=_();return u(e.onInstructionChange())}),r(),o(2,"span"),p(3,"="),r(),o(4,"input",29),v("ngModelChange",function(e){let i=m(n).$implicit;return f(i.value,e)||(i.value=e),u(e)}),d("ngModelChange",function(){m(n);let e=_();return u(e.onInstructionChange())}),r(),o(5,"button",30),d("click",function(){let e=m(n).index,i=_();return u(i.removeLabel(e))}),r()()}if(s&2){let n=l.$implicit;a(),h("ngModel",n.key),a(3),h("ngModel",n.value)}}function he(s,l){s&1&&(o(0,"span",23)(1,"mat-icon"),p(2,"favorite"),r()(),p(3),c(4,"translate")),s&2&&(a(3),k(" ",g(4,1,"CONFIG.HEALTH.TITLE")," "))}function fe(s,l){if(s&1){let n=T();o(0,"div")(1,"div",31)(2,"label"),p(3),c(4,"translate"),r(),o(5,"input",7),v("ngModelChange",function(e){m(n);let i=_();return f(i.healthCmd,e)||(i.healthCmd=e),u(e)}),d("ngModelChange",function(){m(n);let e=_();return u(e.onInstructionChange())}),r()(),o(6,"div",32)(7,"div")(8,"label"),p(9),c(10,"translate"),r(),o(11,"input",7),v("ngModelChange",function(e){m(n);let i=_();return f(i.healthInterval,e)||(i.healthInterval=e),u(e)}),d("ngModelChange",function(){m(n);let e=_();return u(e.onInstructionChange())}),r()(),o(12,"div")(13,"label"),p(14),c(15,"translate"),r(),o(16,"input",7),v("ngModelChange",function(e){m(n);let i=_();return f(i.healthTimeout,e)||(i.healthTimeout=e),u(e)}),d("ngModelChange",function(){m(n);let e=_();return u(e.onInstructionChange())}),r()(),o(17,"div")(18,"label"),p(19),c(20,"translate"),r(),o(21,"input",33),v("ngModelChange",function(e){m(n);let i=_();return f(i.healthRetries,e)||(i.healthRetries=e),u(e)}),d("ngModelChange",function(){m(n);let e=_();return u(e.onInstructionChange())}),r()()()()}if(s&2){let n=_();a(3),C(g(4,8,"CONFIG.HEALTH.CMD")),a(2),h("ngModel",n.healthCmd),a(4),C(g(10,10,"CONFIG.HEALTH.INTERVAL")),a(2),h("ngModel",n.healthInterval),a(3),C(g(15,12,"CONFIG.HEALTH.TIMEOUT")),a(2),h("ngModel",n.healthTimeout),a(3),C(g(20,14,"CONFIG.HEALTH.RETRIES")),a(2),h("ngModel",n.healthRetries)}}var ve=[{label:"SIGTERM",value:"SIGTERM"},{label:"SIGKILL",value:"SIGKILL"},{label:"SIGINT",value:"SIGINT"}],ce=class s{translate=I(D);dockerService=I(re);router=I(B);workdir=M("/app");user=M("appuser");shell=M("");stopsignal=M("SIGTERM");envVars=M([]);labels=M([]);healthcheckEnabled=M(!1);healthCmd=M("curl -f http://localhost:3000/health || exit 1");healthInterval=M("30s");healthTimeout=M("10s");healthRetries=M(3);stopsignalOptions=ve;previous=new O;next=new O;dockerfilePreview=this.dockerService.dockerfilePreview;dockerComposePreview=this.dockerService.composePreview;dockerRunCommand=this.dockerService.cliPreview;addEnv(){this.envVars.set([...this.envVars(),{key:"",value:""}]),this.updateAllSignals()}removeEnv(l){let n=[...this.envVars()];n.splice(l,1),this.envVars.set(n),this.updateAllSignals()}addLabel(){this.labels.set([...this.labels(),{key:"",value:""}]),this.updateAllSignals()}removeLabel(l){let n=[...this.labels()];n.splice(l,1),this.labels.set(n),this.updateAllSignals()}onToggleHealthcheck(){this.healthcheckEnabled.set(!this.healthcheckEnabled()),this.updateAllSignals()}updateAllSignals(){this.generateFileFromInstructions(),this.generateComposeFromInstructions(),this.generateCommandFromInstructions()}generateFileFromInstructions(){let l=this.dockerService.dockerfile();this.dockerService.updateDockerfile(S(y({},l||{}),{workdir:this.workdir(),shell:this.shell(),Stopsignal:this.stopsignal(),healthcheck:this.healthcheckEnabled()?{test:[this.healthCmd()],interval:this.healthInterval(),timeout:this.healthTimeout(),retries:this.healthRetries()}:void 0,user:{username:this.user(),uid:void 0,gid:void 0},environment:Object.fromEntries(this.envVars().filter(n=>n.key).map(n=>[n.key,n.value])),labels:Object.fromEntries(this.labels().filter(n=>n.key).map(n=>[n.key,n.value]))}))}generateComposeFromInstructions(){let l=this.dockerService.compose(),n=l?.services??{};n=S(y({},n),{web:S(y({},n.web),{environment:Object.fromEntries(this.envVars().filter(t=>t.key).map(t=>[t.key,t.value])),labels:Object.fromEntries(this.labels().filter(t=>t.key).map(t=>[t.key,t.value])),healthcheck:this.healthcheckEnabled()?{test:["CMD",this.healthCmd()],interval:this.healthInterval(),timeout:this.healthTimeout(),retries:this.healthRetries()}:void 0,working_dir:this.workdir(),user:this.user(),stop_signal:this.stopsignal()})}),this.dockerService.updateCompose(S(y({},l||{}),{services:n}))}generateCommandFromInstructions(){let l=this.dockerService.cli();console.log("Mise \xE0 jour CLI avec instructions:",l);let n=Object.fromEntries(this.envVars().filter(b=>b.key).map(b=>[b.key,b.value])),t=Object.fromEntries(this.labels().filter(b=>b.key).map(b=>[b.key,b.value])),e=this.user(),i=(l?.runCommands?.length??0)>0?l?.runCommands?.map(b=>S(y({},b),{environment:n,labels:t,user:e})):[{environment:n,labels:t,user:e}];this.dockerService.updateCLI(S(y({},l||{}),{runCommands:i}))}onInstructionChange(){console.log("ConfigurationComponent: onInstructionChange called"),this.updateAllSignals()}onCopyDockerfile(){this.dockerfilePreview&&navigator.clipboard.writeText(this.dockerfilePreview())}onDownloadDockerfile(){if(!this.dockerfilePreview)return;let l=new Blob([this.dockerfilePreview()],{type:"text/plain"}),n=window.URL.createObjectURL(l),t=document.createElement("a");t.href=n,t.download="Dockerfile",t.click(),window.URL.revokeObjectURL(n)}onPrevious(){this.previous.emit(),this.router.navigate(["/instructions"])}onNext(){this.updateAllSignals(),this.next.emit(),this.router.navigate(["/port-reseau"])}static \u0275fac=function(n){return new(n||s)};static \u0275cmp=P({type:s,selectors:[["app-configuration"]],outputs:{previous:"previous",next:"next"},decls:66,vars:55,consts:[[1,"configuration-step"],[1,"step-content"],[1,"left-side"],[1,"section-card"],["pTemplate","title"],[1,"subtitle"],[1,"form-vertical"],["pInputText","",3,"ngModelChange","ngModel"],["pInputText","","placeholder","node, www-data, 1001...",3,"ngModelChange","ngModel"],["pInputText","","placeholder","[bin/batch,-c]",3,"ngModelChange","ngModel"],["optionLabel","label","optionValue","value","placeholder","SIGTERM",3,"ngModelChange","options","ngModel"],[1,"env-list"],["class","env-row",4,"ngFor","ngForOf"],[1,"btn-row"],["icon","pi pi-plus",1,"btn-blue-right",3,"onClick","label"],[1,"switch-row"],[3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"bottom-actions"],["icon","pi pi-arrow-left","severity","secondary",1,"nav-btn","nav-btn-prev",3,"click","label"],["icon","pi pi-arrow-right","iconPos","right",1,"nav-btn","nav-btn-next","btn-blue-right",3,"click","label"],[1,"right-side"],[3,"copy","download","content"],[1,"mat-icon-colored"],[1,"env-row"],["pInputText","","placeholder","KEY",1,"env-key",3,"ngModelChange","ngModel"],["pInputText","","placeholder","value",1,"env-value",3,"ngModelChange","ngModel"],["pButton","","icon","pi pi-trash","aria-label","Supprimer",1,"p-button-rounded","p-button-text",3,"click"],["pInputText","","placeholder","maintainer",1,"env-key",3,"ngModelChange","ngModel"],["pInputText","","placeholder","email",1,"env-value",3,"ngModelChange","ngModel"],["pButton","","icon","pi pi-trash","aria-label","Supprimer",1,"p-button-rounded","p-button-text","btn-blue-right",3,"click"],[1,"command",2,"display","grid"],[1,"health-fields"],["pInputText","","type","number",3,"ngModelChange","ngModel"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-card",3),x(4,ge,5,3,"ng-template",4),o(5,"div",5),p(6),c(7,"translate"),r(),o(8,"div",6)(9,"label"),p(10),c(11,"translate"),r(),o(12,"input",7),v("ngModelChange",function(i){return f(t.workdir,i)||(t.workdir=i),i}),d("ngModelChange",function(){return t.onInstructionChange()}),r(),o(13,"label"),p(14),c(15,"translate"),r(),o(16,"input",8),v("ngModelChange",function(i){return f(t.user,i)||(t.user=i),i}),d("ngModelChange",function(){return t.onInstructionChange()}),r(),o(17,"label"),p(18),c(19,"translate"),r(),o(20,"input",9),v("ngModelChange",function(i){return f(t.shell,i)||(t.shell=i),i}),d("ngModelChange",function(){return t.onInstructionChange()}),r(),o(21,"label"),p(22),c(23,"translate"),r(),o(24,"p-select",10),v("ngModelChange",function(i){return f(t.stopsignal,i)||(t.stopsignal=i),i}),d("ngModelChange",function(){return t.onInstructionChange()}),r()()(),o(25,"p-card",3),x(26,me,5,3,"ng-template",4),o(27,"div",5),p(28),c(29,"translate"),r(),o(30,"div",11),x(31,ue,6,2,"div",12),r(),o(32,"div",13)(33,"p-button",14),c(34,"translate"),d("onClick",function(){return t.addEnv()}),r()()(),o(35,"p-card",3),x(36,_e,5,3,"ng-template",4),o(37,"div",5),p(38),c(39,"translate"),r(),o(40,"div",11),x(41,Ce,6,2,"div",12),r(),o(42,"div",13)(43,"p-button",14),c(44,"translate"),d("onClick",function(){return t.addLabel()}),r()()(),o(45,"p-card",3),x(46,he,5,3,"ng-template",4),o(47,"div",5),p(48),c(49,"translate"),r(),o(50,"div",6)(51,"div",15)(52,"p-toggleswitch",16),v("ngModelChange",function(i){return f(t.healthcheckEnabled,i)||(t.healthcheckEnabled=i),i}),d("ngModelChange",function(){return t.onInstructionChange()}),r(),o(53,"span"),p(54),c(55,"translate"),r()(),x(56,fe,22,16,"div",17),r()(),o(57,"div",18)(58,"p-button",19),c(59,"translate"),d("click",function(){return t.onPrevious()}),r(),o(60,"p-button",20),c(61,"translate"),d("click",function(){return t.onNext()}),r()()(),o(62,"div",21)(63,"dockerfile-preview",22),d("copy",function(){return t.onCopyDockerfile()})("download",function(){return t.onDownloadDockerfile()}),r(),o(64,"docker-compose-preview",22),d("copy",function(){return t.onCopyDockerfile()})("download",function(){return t.onDownloadDockerfile()}),r(),o(65,"docker-command-preview",22),d("copy",function(){return t.onCopyDockerfile()})("download",function(){return t.onDownloadDockerfile()}),r()()()()),n&2&&(a(6),C(g(7,29,"CONFIG.BASE.DESC")),a(4),C(g(11,31,"CONFIG.BASE.WORKDIR")),a(2),h("ngModel",t.workdir),a(2),C(g(15,33,"CONFIG.BASE.USER")),a(2),h("ngModel",t.user),a(2),C(g(19,35,"CONFIG.BASE.SHELL")),a(2),h("ngModel",t.shell),a(2),C(g(23,37,"CONFIG.BASE.STOPSIGNAL")),a(2),w("options",t.stopsignalOptions),h("ngModel",t.stopsignal),a(4),C(g(29,39,"CONFIG.ENV.DESC")),a(3),w("ngForOf",t.envVars()),a(2),w("label",E(g(34,41,"CONFIG.ENV.ADD"))),a(5),C(g(39,43,"CONFIG.LABEL.DESC")),a(3),w("ngForOf",t.labels()),a(2),w("label",E(g(44,45,"CONFIG.LABEL.ADD"))),a(5),C(g(49,47,"CONFIG.HEALTH.DESC")),a(4),h("ngModel",t.healthcheckEnabled),a(2),C(g(55,49,"CONFIG.HEALTH.ENABLED")),a(2),w("ngIf",t.healthcheckEnabled),a(2),w("label",E(g(59,51,"COMMON.BACK_INSTRUCTION"))),a(2),w("label",E(g(61,53,"COMMON.NEXT_PORTS"))),a(3),w("content",t.dockerfilePreview()),a(),w("content",t.dockerComposePreview()),a(),w("content",t.dockerRunCommand()))},dependencies:[L,V,N,A,F,U,J,Q,ee,$,G,Z,q,K,Y,z,X,oe,ie,ne,te,j,R,H,de,se,ae,le,pe,W],styles:[".configuration-step[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:#f7fafd}.configuration-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{display:flex;gap:30px;max-width:1200px;margin:0 auto;align-items:flex-start}@media (max-width: 1050px){.configuration-step[_ngcontent-%COMP%]   .step-content[_ngcontent-%COMP%]{flex-direction:column}}.configuration-step[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]{flex:1.7;min-width:340px;max-width:540px;display:flex;flex-direction:column;gap:22px}.configuration-step[_ngcontent-%COMP%]   .right-side[_ngcontent-%COMP%]{flex:2.1;min-width:350px;max-width:650px;gap:10px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]{margin-bottom:0;box-shadow:0 2px 12px #0077ee10;border-radius:14px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .p-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#496ab1;font-size:1rem;margin-bottom:10px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .form-vertical[_ngcontent-%COMP%], .configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .env-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:9px;margin-top:9px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .env-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;margin-bottom:3px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .env-row[_ngcontent-%COMP%]   input[pInputText][_ngcontent-%COMP%]{min-width:70px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .env-row[_ngcontent-%COMP%]   .env-key[_ngcontent-%COMP%]{width:140px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .env-row[_ngcontent-%COMP%]   .env-value[_ngcontent-%COMP%]{width:210px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .btn-row[_ngcontent-%COMP%]{margin-top:7px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .switch-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:12px}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .health-fields[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:6px;flex-wrap:wrap}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .health-fields[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1 1 30%;min-width:0;max-width:100%}.configuration-step[_ngcontent-%COMP%]   .section-card[_ngcontent-%COMP%]   .health-fields[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;min-width:0}.configuration-step[_ngcontent-%COMP%]   .bottom-actions[_ngcontent-%COMP%]{margin-top:26px;display:flex;justify-content:space-between;gap:20px}"],changeDetection:0})};export{ce as ConfigurationComponent};
